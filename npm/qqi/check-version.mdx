---
title: qqiï¼šæ£€æµ‹åŒ…ç‰ˆæœ¬ (@qqi/check-version) - npm
sidebar_label: æ£€æµ‹åŒ…ç‰ˆæœ¬ï¼ˆ@qqi/check-versionï¼‰
hide_title: true
---

# æ£€æµ‹å½“å‰ npm åŒ…çš„ç‰ˆæœ¬

<PackageInfo packageName="@qqi/check-version" githubRepoName="qqi" />

ç”¨äºæ£€æµ‹ npm åº“åŒ…çš„ç‰ˆæœ¬æ˜¯å¦å·²å­˜åœ¨ï¼Œä¸”è¿”å›è¯†åˆ«çš„ `dist-tag` (éœ€è¦æ˜¯ç¬¦åˆæ ‡å‡†çš„ç‰ˆæœ¬å·ï¼Œå¦åˆ™å°†è¯†åˆ«ä¸º `latest`)

## å®‰è£…

<InstallInfo name="@qqi/check-version" dev />

## ä½¿ç”¨

é»˜è®¤ä½¿ç”¨æ–¹å¼ä¸ºä¼ å…¥ `name` å‚æ•°ï¼Œä»£ç å°†æ‰§è¡Œåˆ¤æ–­å·¥ä½œç›®å½•ä¸‹çš„ 'packages/[name]' å­ npm åŒ…çš„ç‰ˆæœ¬å·æ˜¯å¦å·²å­˜åœ¨äºçº¿ä¸Š

```bash
# å†™æ³•ä¸€
npx @qqi/check-version name=[name]
# å†™æ³•äºŒ
npx @qqi/check-version n=[name]
# å†™æ³•ä¸‰
npx @qqi/check-version name [name]
# å†™æ³•å››
npx @qqi/check-version n [name]
```

ä¹Ÿå¯ä»¥ä¼ å…¥ `cwd` å‚æ•°è¦†ç›–é»˜è®¤çš„åˆ¤æ–­æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æŸ¥æ‰¾ 'packages' æ–‡ä»¶å¤¹ä¸‹å­ npm åŒ…ï¼Œè‹¥æ‚¨ä¹ æƒ¯äºå…¶ä»–å‘½åæ–¹å¼

```bash
# å€˜è‹¥å­ä¸»åŒ… core åœ¨ lists æ–‡ä»¶å¤¹ä¸‹
npx @qqi/check-version name=core cwd=lists  # æ¨èæ¨¡å¼

npx @qqi/check-version name core cwd lists

npx @qqi/check-version name=core cwd lists

npx @qqi/check-version name core cwd=lists

npx @qqi/check-version n=core c=lists  # æ¨èæ¨¡å¼

npx @qqi/check-version n core c lists
```

é»˜è®¤çš„ name å€¼ä¸º "." ï¼Œå³ä»¥ packages ç›®å½•ä¸ºé¡¹ç›®çš„æ ¹ï¼ˆå€˜è‹¥ package.json æ–‡ä»¶åœ¨è¿™é‡Œçš„è¯ï¼‰

ä½¿ç”¨ skip å‚æ•°æ˜¯å¦è·³è¿‡æ‰§è¡Œçº¿ä¸Šç‰ˆæœ¬æ£€æµ‹ï¼ˆå› ä¸º '0.0.0' çš„ç‰ˆæœ¬é»˜è®¤ä¸ºè·³è¿‡æ£€æµ‹ï¼Œè‹¥åˆå§‹ç‰ˆæœ¬é '0.0.0' æ—¶ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å‚æ•°è·³è¿‡æ£€æµ‹ï¼‰

```bash
# å€˜è‹¥å­ä¸»åŒ… core åœ¨ lists æ–‡ä»¶å¤¹ä¸‹
npx @qqi/check-version name=core cwd=lists skip  # æ¨èæ¨¡å¼

npx @qqi/check-version name=core cwd lists skip

npx @qqi/check-version n=core c=lists s # æ¨èæ¨¡å¼

npx @qqi/check-version n=core c lists s
```

è‹¥æƒ³åœ¨å…¶ä»–éåˆ†åŒ…çš„é¡¹ç›®ä½¿ç”¨ï¼Œå³å•ç‹¬çš„é¡¹ç›®ä½¿ç”¨é…ç½®ï¼Œä½¿ç”¨ `npx @qqi/check-version c=.` å³å¯ã€‚

## ä½¿ç”¨ç¤ºä¾‹

åœ¨ `pub.sh` æ–‡ä»¶ä¸­ä½¿ç”¨æ—¶ï¼š

```bash
CHECK_VERSION="@qqi/check-version"
install_check_version() {
    if ! npm  list -g --depth=0 | grep -q " ${CHECK_VERSION}"; then
        echo "å½“å‰æœªå…¨å±€å®‰è£… '${CHECK_VERSION}'ï¼Œå³å°†è¿›è¡Œå®‰è£…"
        npm install ${CHECK_VERSION} --global
    else
         echo "åŒ… ${CHECK_VERSION} å·²å…¨å±€å®‰è£…"
    fi
}
# è¾“å‡ºçš„ npm å‘å¸ƒçš„ tagã€‚ä¹Ÿå¯ä»¥é€šè¿‡è°ƒæ•´ cwd å’Œ name çš„å‚æ•°æ¥é€‚é…å®é™…çš„é¡¹ç›®åœ°å€
tag=""
install_check_version
if ! tag=$(npx "${CHECK_VERSION}" c=. 2>&1); then
    echo "æœªé€šè¿‡ç‰ˆæœ¬æ ¡éªŒï¼š$tag"
    exit 1
fi
echo "è·å–ğŸ‰å‘å¸ƒæ ‡ç­¾ä¸º ${tag}"
# å®‰è£…
npm ci

echo "å¼€å§‹å‘å¸ƒ npm åŒ…"

if ! npm publish --provenance --access public --tag ${tag} ; then
    echo "å‘å¸ƒå¤±è´¥"
    exit 0
fi

echo "ğŸš€ğŸš€  å‘å¸ƒæˆåŠŸï¼Œå®Œç»“ ğŸ‰ğŸ‰ æ’’èŠ± ğŸ‰ğŸ‰"
```

ä½¿ç”¨ [`npx @qqi/check-version`](https://www.npmjs.com/package/@qqi/check-version) è·å–çš„ tag æ˜¯ç¬¦åˆæ ‡å‡† npm çš„é¢„å‘å¸ƒç‰ˆæœ¬çš„ç‰ˆæœ¬å·çš„è§„åˆ™ã€‚é€šè¿‡ [`npx vjj`](https://www.npmjs.com/package/vjj) è¿›è¡Œç‰ˆæœ¬çš„è¿­ä»£ç®¡ç†å³ç¬¦åˆæ ‡å‡†çš„ npm çš„ publish çš„é¢„å‘å¸ƒçš„ tag ï¼Œä¹Ÿå°†åœ¨ `CHANGELOG.md` æ–‡ä»¶æ·»åŠ æ›´æ–°è¿­ä»£çš„ç‰ˆæœ¬çš„æ—¥å¿—è®°å½•çš„æ ‡é¢˜ï¼ˆå¹¿å­ï¼Œè¿™å°±æ˜¯å¹¿å­ï¼‰ã€‚

æ‰€ä»¥ï¼Œä¸Šé¢çš„ .sh æ–‡ä»¶å°†æå– "0.0.1" çš„ tag å€¼ä¸º "latest"ï¼Œè‹¥æå– "0.1.0-test.0" åˆ™æå–å‡º "test"
