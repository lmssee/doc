---
slug: æµ‹è¯•è¦†ç›–ç‡
title: æµ‹è¯•è¦†ç›–ç‡
tags: [æµ‹è¯•]
description: ä½¿ç”¨ Coverageã€Codecov æˆ– SonarCloud ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡
---

# æµ‹è¯•è¦†ç›–ç‡

æµ‹è¯•è¦†ç›–ç‡æ˜¯æµ‹è¯•ä»£ç çš„è´¨é‡ï¼Œå®ƒè¡¨ç¤ºä»£ç è¢«æµ‹è¯•çš„ç™¾åˆ†æ¯”ã€‚

åœ¨ç³»ç»Ÿå­¦ä¹ æ„å»º npm åŒ…æ—¶ï¼Œå‘ç°åœ¨æ¨èçš„å¾½ç« å±•ç¤ºä¸­åŒ…å«æµ‹è¯•è¦†ç›–ç‡çš„å¾½ç« ï¼Œæœ‰åŠ©äºå¸®åŠ©ç”¨æˆ·äº†è§£ä»£ç çš„è´¨é‡ã€‚

ä½†æ˜¯è²Œä¼¼é‡è§äº†æˆ‘çš„çŸ¥è¯†ç›²åŒºï¼Œé‚å­¦ä¸”è®°ä¹‹ã€‚

{/* truncate */}

## ğŸ”§

| ğŸ”§          | ç‰¹ç‚¹                                            |
| ----------- | ----------------------------------------------- |
| [Coveralls] | æ”¯æŒå¤šç§è¯­è¨€ï¼Œä¸ github é›†æˆç®€å•ï¼Œé€‚åˆå¼€æºé¡¹ç›®  |
| [codecov]   | æ”¯æŒ æ›´è¯¦ç»†çš„æŠ¥å‘Šåˆ†æï¼Œé€‚åˆå¤æ‚çš„é¡¹ç›®           |
| SonarCloud  | æä¾›ä»£ç è´¨é‡ + è¦†ç›–ç‡ç»¼åˆæŠ¥å‘Šï¼Œé€‚åˆä¼ä¸šçº§çš„é¡¹ç›® |

è¿™é‡Œä»¥ [coveralls] åŠ [codecov] ä¸ºä¾‹ã€‚

## ğŸ”§ [Coveralls]

### 1. å®‰è£…

```bash
npm install --save-dev jest jest-junit coveralls # ç”Ÿæˆ JUnit æ ¼å¼æµ‹è¯•æŠ¥å‘Š
npm install --save-dev ts-jest ts-node @types/jest
npm install --save-dev jest-environment-jsdom
```

### 2. é…ç½®

#### åœ¨ `package.json` æ–‡ä»¶ä¸­æ·»åŠ  `scripts` é…ç½®

```json title="package.json"
"scripts": {
  "test": "jest --coverage",
  "report": "cat ./coverage/lcov.info | coveralls"
}
```

#### åœ¨ `jest.config.js` æ–‡ä»¶ä¸­æ·»åŠ é…ç½®

```bash
node --eval="fs.mkdirSync('.github/workflows', { recursive: true })"
```

```js title="jest.config.js"
module.exports = {
  collectCoverage: true,
  coverageDirectory: 'coverage',
  coverageReporters: ['lcov', 'text-summary'],
  collectCoverageFrom: [
    'src/**/*.{js,jsx}',
    '!**/node_modules/**',
    '!**/vendor/**',
  ],
};
```

#### github actions é…ç½®

åˆ›å»ºï¼ˆå·²æœ‰å¯ä¿®æ”¹ï¼‰.github/workflows/coverage.yml æ–‡ä»¶

```bash
node --eval "fs.mkdirSync('.github/workflows/', { recursive: true })"
```

```yaml title=".github/workflows/coverage.yml"
name: Run tests and upload coverage

on:
  push:
    branches: [main]
    # tags: ['*']

jobs:
  test:
    name: Run tests and collect coverage
    runs-on: ubuntu-latest
    # ä»…å½“æäº¤æ¶ˆæ¯åŒ…å« "version" æ—¶è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
    if: contains(github.event.head_commit.message, 'version')
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.x

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npx jest --coverage

      - name: copy coverage to test-coverage directory
        uses: coverallsapp/github-action@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN}} # ${{ secrets.COVERALLS_REPO_TOKEN }}
          path-to-lcov: ./coverage/lcov.info
```

### 3. coveralls é›†æˆ

- è·å– tokenï¼ˆå¼€æºä»“åº“å¯ä»¥ä½¿ç”¨ `GITHUB_TOKEN` ä»£æ›¿ï¼‰
  - ç™»å½• [https://coveralls.io/]
  - ç‚¹å‡» `Add Repo` æŒ‰é’®ï¼Œæ·»åŠ ä»“åº“
  - è·å– COVERALLS_REPO_TOKEN (è‡ªåŠ¨ç”Ÿæˆ)
- é…ç½® github secrets
  - åœ¨ Settings â¡ï¸ secrets â¡ï¸ Actions æ·»åŠ ï¼š `COVERALLS_REPO_TOKEN: <your_token>`

```yaml
COVERALLS_REPO_TOKEN: <your-token>
```

### 4. æœ¬åœ°è°ƒè¯•å‘½ä»¤

```bash
COVERALLS_REPO_TOKEN=your_token npm run report
```

### 5. æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

ä¸‹é¢æ˜¯ [a-type-of-js] çš„ [coveralls] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š [![Coverage Status](https://coveralls.io/repos/github/earthnutDev/a-type-of-js/badge.svg?branch=main)](https://coveralls.io/github/earthnutDev/a-type-of-js?branch=main)

## ğŸ”§ [Codecov]

[Codecov] æ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç è¦†ç›–ç‡å¹³å°ï¼Œå®ƒæä¾›äº†è¯¦ç»†çš„æŠ¥å‘Šåˆ†æï¼Œé€‚åˆå¤æ‚çš„é¡¹ç›®ã€‚
[Codecov] æ”¯æŒå¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ JavaScriptã€Pythonã€Rubyã€Javaã€C++ã€C#ã€Goã€Swiftã€Kotlinã€Rustã€PHPã€Rã€Scalaã€Perlã€Luaã€Erlangã€Haskellã€OCamlã€Clojureã€Elixirã€Pascalã€Dartã€Racketã€Lispã€Fortranã€Adaã€Prologã€VBScriptã€VBAã€Visual Basicã€Objective-Cã€Objective-C++ã€Assemblyã€Cã€‚

### 1. å®‰è£…

```bash
npm install --save-dev jest jest-junit codecov # ç”Ÿæˆ JUnit æ ¼å¼æµ‹è¯•æŠ¥å‘Š
npm install --save-dev ts-jest ts-node @types/jest
npm install --save-dev jest-environment-jsdom
```

### 2. é…ç½®

#### åœ¨ `package.json` æ–‡ä»¶ä¸­æ·»åŠ  `scripts` é…ç½®

```json title="package.json"
"scripts": {
  "test": "jest --coverage",
  "coverage": "codecov"
}
```

#### åœ¨ `jest.config.js` æ–‡ä»¶ä¸­æ·»åŠ é…ç½® (åŒ [coveralls])

```js title="jest.config.js"
module.exports = {
  collectCoverage: true,
  coverageDirectory: 'coverage',
  coverageReporters: ['lcov', 'text-summary'],
  collectCoverageFrom: [
    'src/**/*.{js,jsx}',
    '!**/node_modules/**',
    '!**/vendor/**',
  ],
};
```

#### github actions é…ç½®

åˆ›å»ºï¼ˆå·²æœ‰å¯ä¿®æ”¹ï¼‰.github/workflows/coverage.yml æ–‡ä»¶

```bash
node --eval "fs.mkdirSync('.github/workflows/', { recursive: true })"
```

```yaml title=".github/workflows/coverage.yml"
name: Run tests and upload coverage

on:
  push:
    branches: [main]
    # tags: ['*']

jobs:
  test:
    name: Run tests and collect coverage
    runs-on: ubuntu-latest
    # ä»…å½“æäº¤æ¶ˆæ¯åŒ…å« "version" æ—¶è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
    if: contains(github.event.head_commit.message, 'version')
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.x

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npx jest --coverage

      - name: Upload results to Codecov
        uses: codecov/codecov-action@v5
        with:
          # token: ${{ secrets.CODECOV_TOKEN }} # ä»…ç§äººä»“åº“éœ€è¦
          files: ./coverage/lcov.info
          verbose: true
```

### 3. codecov é›†æˆ

- è·å– `token`ï¼ˆå…¬å¼€ä»“åº“å¯ä»¥çœç•¥ `token`ï¼‰
  - ç™»å½• [codecov]
  - ç‚¹å‡» `Add Repo` æŒ‰é’®ï¼Œæ·»åŠ ä»“åº“
  - è·å– CODECOV_TOKEN (è‡ªåŠ¨ç”Ÿæˆ)
- é…ç½® github secrets
  - åœ¨ Settings â¡ï¸ secrets â¡ï¸ Actions æ·»åŠ ï¼š `CODECOV_TOKEN: <your_token>`

```yaml
CODECOV_TOKEN: <your-token>
```

### 4. æœ¬åœ°è°ƒè¯•å‘½ä»¤

```bash
CODECOV_TOKEN=your_token npm run coverage
```

### 5. æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

ä¸‹é¢æ˜¯ [a-type-of-js] çš„ [codecov] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š [![codecov](https://codecov.io/gh/earthnutDev/a-type-of-js/branch/main/graph/badge.svg)](https://codecov.io/gh/earthnutDev/a-type-of-js)

## å®Œæ•´çš„ç¤ºä¾‹

### å®‰è£…

```bash
npm install --save-dev jest jest-junit coveralls codecov # ç”Ÿæˆ JUnit æ ¼å¼æµ‹è¯•æŠ¥å‘Š
npm install --save-dev ts-jest ts-node @types/jest
npm install --save-dev jest-environment-jsdom
```

### é…ç½® jest.config.js

```js title="jest.config.js"
/** @type {import('ts-jest').JestConfigWithTsJest} **/
export default () => {
  return {
    collectCoverage: true,
    collectCoverageFrom: ['index.ts', '!**/node_modules/**', '!**/vendor/**'],
    coveragePathIgnorePatterns: ['/node_modules/', '/dist/', 'test', '.*.d.ts'],
    coverageReporters: ['text', 'lcov', 'html', 'text-summary'],
    coverageDirectory: 'coverage',
    preset: 'ts-jest',
    verbose: true,
    testEnvironment: 'node',
    transform: {
      '^.+\\.tsx?$': [
        'ts-jest',
        {
          isolatedModules: true,
          tsconfig: 'tsconfig.json',
        },
      ],
    },
    testMatch: ['**/*.test.(js|ts|tsx)'],
  };
};
```

### é…ç½® package.json

```json title="package.json"
{
  "scripts": {
    "test": "jest --coverage",
    "report": "cat ./coverage/lcov.info | coveralls",
    "coverage": "codecov"
  }
}
```

### é›†æˆ [codecov]ã€[coveralls]

- ä½¿ç”¨ github è´¦å·åˆ†åˆ«ç™»å½• [codecov]ã€[coveralls]
- æ·»åŠ ä»“åº“
- è·å– token ï¼ˆéç§äººä»“åº“å¯ä»¥çœç•¥ `token`ï¼‰
- é…ç½® github secrets

### æœ€ç»ˆçš„ coverage.yml

{/* node --eval "$(curl -sL https://raw.githubusercontent.com/codecov/codecov-bash/master/codecov)" */}

```bash
node --eval "fs.mkdirSync('.github/workflows/', { recursive: true })"
```

```yml title=".github/workflows/coverage.yml"
name: Run tests and upload coverage

on:
  push:
    branches: [main]

jobs:
  test:
    name: Run tests and collect coverage
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'version')
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.x

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npx jest --coverage

      - name: Upload results to Codecov
        uses: codecov/codecov-action@v5
        with:
          # token: ${{ secrets.CODECOV_TOKEN }}
          files: ./coverage/lcov.info
          verbose: true

      - name: copy coverage to test-coverage directory
        uses: coverallsapp/github-action@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          path-to-lcov: ./coverage/lcov.info
```

## å‚è€ƒèµ„æ–™

- [Coveralls]
- [Codecov]
- [a-type-of-js]

[coveralls]: https://coveralls.io/
[Coveralls]: https://coveralls.io/
[codecov]: https://codecov.io/
[Codecov]: https://codecov.io/
[a-type-of-js]: https://www.npmjs.com/a-type-of-js
